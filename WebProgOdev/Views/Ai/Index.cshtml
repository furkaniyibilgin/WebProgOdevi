@model WebProgOdev.Models.AiViewModel

@{
    ViewData["Title"] = "AI Öneri";
}

<div class="card p-4">
    <h2 class="mb-4">AI Öneri</h2>

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <div>@error.ErrorMessage</div>
            }
        </div>
    }

    <form method="post" class="mt-3">
        <div class="mb-3">
            <label class="form-label">Hedef</label>
            <input asp-for="Goal" class="form-control" placeholder="Örn: Kilo vermek istiyorum" />
            @Html.ValidationMessageFor(m => m.Goal, "", new { @class = "text-danger" })
        </div>

        <div class="mb-3">
            <label class="form-label">Ek Not</label>
            <textarea asp-for="Notes" class="form-control" rows="3"
                      placeholder="Örn: Dizimde ağrı var, hafif program olsun"></textarea>
            @Html.ValidationMessageFor(m => m.Notes, "", new { @class = "text-danger" })
        </div>

        <button type="submit" class="btn btn-primary">AI ile Öneri Al</button>
    </form>

    @if (!string.IsNullOrWhiteSpace(Model.Result))
    {
        <hr />
        <h4>AI Sonucu</h4>
        <pre style="white-space:pre-wrap; margin:0;">@Model.Result</pre>
    }

    @* Görseli önerilerin ALTINA aldık ve placeholder ekledik *@
    @if (!string.IsNullOrWhiteSpace(Model.ImageUrl))
    {
        <hr />
        <h4 class="mb-3">AI Görseli</h4>

        <!-- Placeholder (yüklenene kadar görünür) -->
        <div id="imgPlaceholder" class="p-3 rounded border" style="border-color: #374151;">
            <div class="text-muted">Görsel hazırlanıyor...</div>
            <div class="mt-2" style="height:220px; border-radius:12px; background: rgba(255,255,255,0.04);"></div>
        </div>

        <!-- Asıl görsel (yüklenince görünür) -->
        <img id="aiImg"
             src="@Model.ImageUrl"
             class="img-fluid rounded mt-3"
             alt="AI Generated Image"
             style="display:none;"
             onload="document.getElementById('imgPlaceholder').style.display='none'; this.style.display='block';"
             onerror="document.getElementById('imgPlaceholder').innerHTML='<div class=&quot;text-danger&quot;>Görsel yüklenemedi. Tekrar deneyin.</div>';" />

        <small class="text-muted d-block mt-2">
            Görsel: Pollinations AI üzerinden üretilmiştir.
        </small>
    }

    @section Scripts {
        <partial name="_ValidationScriptsPartial" />
    }
</div>
